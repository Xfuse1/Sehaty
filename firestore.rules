rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Enforces access control for user profiles. Only the authenticated user can read or write their own profile.
     * @path /users/{userId}
     * @allow (create) User with ID 'user123' can create their profile if authenticated as 'user123'.
     * @allow (get, update, delete) User with ID 'user123' can get, update, or delete their profile if authenticated as 'user123'.
     * @deny (create, get, update, delete) User with ID 'user456' cannot access the profile of 'user123', even if authenticated.
     * @principle Enforces document ownership for reads and writes.
     */
    match /users/{userId} {
      function isSignedIn() {
        return request.auth != null;
      }

      function isOwner(userId) {
        return request.auth.uid == userId;
      }

      allow get: if isSignedIn() && isOwner(userId);
      allow list: if false; // Listing users is not allowed.
      allow create: if isSignedIn() && isOwner(userId);
      allow update: if isSignedIn() && isOwner(userId);
      allow delete: if isSignedIn() && isOwner(userId);
    }

    /**
     * @description Allows public read access to pharmacy information. Write access is denied.
     * @path /pharmacies/{pharmacyId}
     * @allow (get, list) Any user can read pharmacy information.
     * @deny (create, update, delete) No user can create, update, or delete pharmacy information through client-side rules.
     * @principle Provides public read access while restricting write access to prevent unauthorized modifications.
     */
    match /pharmacies/{pharmacyId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows public read access to physiotherapy package information. Write access is denied.
     * @path /physiotherapyPackages/{packageId}
     * @allow (get, list) Any user can read physiotherapy package information.
     * @deny (create, update, delete) No user can create, update, or delete physiotherapy package information through client-side rules.
     * @principle Provides public read access while restricting write access to prevent unauthorized modifications.
     */
    match /physiotherapyPackages/{packageId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows public read access to nursing care service information. Write access is denied.
     * @path /nursingCareServices/{nursingCareId}
     * @allow (get, list) Any user can read nursing care service information.
     * @deny (create, update, delete) No user can create, update, or delete nursing care service information through client-side rules.
     * @principle Provides public read access while restricting write access to prevent unauthorized modifications.
     */
    match /nursingCareServices/{nursingCareId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows public read access to lab service information. Write access is denied.
     * @path /labServices/{labServiceId}
     * @allow (get, list) Any user can read lab service information.
     * @deny (create, update, delete) No user can create, update, or delete lab service information through client-side rules.
     * @principle Provides public read access while restricting write access to prevent unauthorized modifications.
     */
    match /labServices/{labServiceId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows public read access to clinic information. Write access is denied.
     * @path /clinics/{clinicId}
     * @allow (get, list) Any user can read clinic information.
     * @deny (create, update, delete) No user can create, update, or delete clinic information through client-side rules.
     * @principle Provides public read access while restricting write access to prevent unauthorized modifications.
     */
    match /clinics/{clinicId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Enforces access control for doctors associated with a clinic.  Write access is denied.
     * @path /clinics/{clinicId}/doctors/{doctorId}
     * @allow (get, list) Any user can read doctor information associated with a specific clinic.
     * @deny (create, update, delete) No user can create, update, or delete doctor information through client-side rules.
     * @principle Provides public read access while restricting write access to prevent unauthorized modifications.
     */
    match /clinics/{clinicId}/doctors/{doctorId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Enforces access control for bookings under a specific user. Only the authenticated user can read or write their own bookings.
     * @path /users/{userId}/bookings/{bookingId}
     * @allow (create) User with ID 'user123' can create a booking under their user ID if authenticated as 'user123'.
     * @allow (get, update, delete) User with ID 'user123' can get, update, or delete their booking if authenticated as 'user123'.
     * @deny (create, get, update, delete) User with ID 'user456' cannot access the bookings of 'user123', even if authenticated.
     * @principle Enforces document ownership for reads and writes of booking data.
     */
    match /users/{userId}/bookings/{bookingId} {
      function isSignedIn() {
        return request.auth != null;
      }

      function isOwner(userId) {
        return request.auth.uid == userId;
      }

      allow get: if isSignedIn() && isOwner(userId);
      allow list: if isSignedIn() && isOwner(userId);
      allow create: if isSignedIn() && isOwner(userId);
      allow update: if isSignedIn() && isOwner(userId);
      allow delete: if isSignedIn() && isOwner(userId);
    }
  }
}